<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <meta name="author" content="fkemps@fortinet.com">
  
  <link rel="shortcut icon" href="../img/favicon.ico">
  <title>Fwb machinelearning advanced old - FortiWeb Machine Learning</title>
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700" />

  <link rel="stylesheet" href="../css/theme.css" />
  <link rel="stylesheet" href="../css/theme_extra.css" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/github.min.css" />
  
  <script>
    // Current page data
    var mkdocs_page_name = "Fwb machinelearning advanced old";
    var mkdocs_page_input_path = "fwb-machinelearning-advanced-old.md";
    var mkdocs_page_url = null;
  </script>
  
  <script src="../js/jquery-2.1.1.min.js" defer></script>
  <script src="../js/modernizr-2.8.3.min.js" defer></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
  <script>hljs.initHighlightingOnLoad();</script> 
  
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
        <a href=".." class="icon icon-home"> FortiWeb Machine Learning</a>
        <div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="..">Introduction</a>
                    </li>
                </ul>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../fwb-machinelearning-refresh/">Info - Machine Learning</a>
                    </li>
                </ul>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../setup/">Preparation (mandatory)</a>
                    </li>
                </ul>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../fwb-machinelearning-basic/">Demo - Anomaly Detection</a>
                    </li>
                </ul>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../fwb-machinelearning-bot-basic/">Demo - Bot Detection</a>
                    </li>
                </ul>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../fwb-machinelearning-advanced/">Lab - Anomaly Detection</a>
                    </li>
                </ul>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../fwb-machinelearning-api/">Lab - API Protection</a>
                    </li>
                </ul>
      </div>
      <div class="navcenterfabric">
        <img src="../img/fabric-small.png">
      </div>
      <div class="navcenter">
        <img src="../img/fortinetlogonav.png">
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="..">FortiWeb Machine Learning</a>
      </nav>

      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="..">Docs</a> &raquo;</li>
    
      
    
    <li>Fwb machinelearning advanced old</li>
    <li class="wy-breadcrumbs-aside">
      
    </li>
  </ul>
  
  <hr/>
</div>
          <div role="main">
            <div class="section">
              
                <h1 id="machine-learning-for-anomaly-detection">Machine Learning for Anomaly Detection.</h1>
<p>Goal of this workshop is to run and test FortiWeb Machine Learning for Anomaly Detection in Reverse Proxy mode in three steps:</p>
<h3 id="learn-e-mail-based-model">Learn e-mail based model</h3>
<p>Step 1 of 2: building a model based on <h7 style="color:red;">e-mail address</h7> input type.</p>
<ul>
<li>
<p>Test Goal: send valid+noise+anomaly+attack mixed traffic.</p>
</li>
<li>
<p>Expected Result: Machine Learning to Detect, Block &amp; Log relevant traffic.</p>
</li>
</ul>
<h3 id="rebuild-small-number-based-model">Rebuild small-number based model</h3>
<p>Step 2 of 2: Manually rebuild the model based on <h7 style="color:red;">small numbers</h7> format as NEW input type. <br />
After that will trigger <em>auto-rebuild</em> based on <h7 style="color:red;">long-date</h7> format as NEW input type</p>
<ul>
<li>
<p>Test Goal: run traffic with <strong>NEW</strong> type of parameter.</p>
</li>
<li>
<p>Expected Result: </p>
</li>
<li>Manually forcing Machine Learning to rebuild its model according to the <strong>NEW</strong> type of parameter inputs(<h7 style="color:red;">number-small</h7>).</li>
<li>
<p>Machine Learning to <strong>auto-rebuild</strong> its model according to the <strong>NEW</strong> type of parameter inputs(<h7 style="color:red;">date-long</h7>).</p>
</li>
<li>
<p>Test: run traffic with <strong>ADDITIONAL</strong> type of parameter.</p>
</li>
<li>
<p>Expected Result: Machine Learning to <strong>relearn</strong> its model by keeping previous samples and merging them with additional <strong>ADDITIONAL</strong> type of parameter inputs.</p>
</li>
</ul>
<p><strong>Please read following REMINDERS if not seen before.</strong></p>
<p><strong><em>Then, run following A, B, C steps below in the right order.</em></strong></p>
<ul>
<li>A. Configuration Setup.</li>
<li>B. Step 1/2: building a model based on EMAIL input type.</li>
<li>C. Step 2/2: re-building the model based on SHORT date format input type.</li>
</ul>
<hr />
<!--###Reminders

The two Levels Processing FortiWeb Machine Learning for Anomaly Detection are:

 * Level1: HMM for **Anomaly Detection** (Hidden Markov Model)
 * Level2: SVM for **Attack Identification** (Support Vector Machine)

**Reminder 1.** Why Machine Learning for Anomaly Detection in WAF

![](img/fwb-ws-ml-why.png)

**Reminder 2.** FortiWeb AI-Machine Learning is the last level of mitigation for Unknown Application Attacks

![](img/fwb-ws-features-pyramid.png)

**Reminder 3.** Why  FortiWeb runs two LAYERS of AI-Machine Learning

![](img/fwb-ws-ml-2layers.png)

**Reminder 4.** FortiWeb AI-Machine Learning HMM LAYER1 for Anomaly Detection.

![](img/fwb-ws-ml-hmmlayer.png)

**Reminder 5.** FortiWeb AI-Machine Learning SVM LAYER2 for Attack Detection.

![](img/fwb-ws-ml-svmlayer.png)

**Reminder 6.** Machine Learning PHASE1: Model Building & Anomaly Scoring.

![](img/fwb-ws-ml-phase1.png)

**Reminder 7.** Machine Learning PHASE2: Scoring Distribution Results.

![](img/fwb-ws-ml-phase2.png)

**Reminder 8.** Machine Learning PHASE3: Specific Cases SIGMA tuning.

![](img/fwb-ws-ml-phase3.png)

**Reminder 9.** Machine Learning PHASE4: Application Change Detection.

![](img/fwb-ws-ml-boxplot1.png)
![](img/fwb-ws-ml-boxplot1-2.png)-->

<hr />
<p>Let's now check the configuration and run following tests.</p>
<ul>
<li>A. Configuration Setup.</li>
<li>B. Step 1/2: building a model based on username@domain.com USERNAME input type.</li>
<li>C. Step 2/2: re-building the model based on LONG date format input type.</li>
</ul>
<h3 id="a-configuration-setup">A. Configuration Setup</h3>
<p><strong>Note: Make sure you have done the manual preparation first to complete the environment!</strong></p>
<p>Then, set the configuration by following steps:</p>
<h4 id="a1-enable-ml-logging">A.1. Enable ML-logging</h4>
<p><strong>(This is for verification only, it has been preconfigured)</strong></p>
<ul>
<li>Log&amp;Report &gt; Log Config &gt; Other Log Settings</li>
<li>Enable Traffic Packer log: <strong>Enable</strong></li>
<li>Machine Learning: <strong>Enable</strong></li>
<li>Apply</li>
</ul>
<p><img alt="" src="../img/fwb-ws-ml2.png" /></p>
<h4 id="a2-configure-machine-learning">A.2. Configure Machine Learning</h4>
<p><strong>(This is for verification only, it has been preconfigured. Just make sure there is no protection Profile apply)</strong></p>
<ul>
<li>Policy &gt; Server Policy &gt; <strong>Finance</strong><ul>
<li>Web Protection Profile: <strong>[Please Select...]</strong> (If This is still having a profile please change it)</li>
<li>OK (Make sure you hit the OK first, else the Web Protection Profile will not be saved)</li>
<li>Machine Learning &gt; <strong>Create</strong></li>
</ul>
</li>
</ul>
<p><strong><em>Here are the steps to enable Machine Learning Anomaly from scratch:</em></strong> <br />
<img alt="" src="img/fwb-ws-mlp4.png" /></p>
<ul>
<li>Allow sample collection for domain: <strong>finance.fortinet.demo</strong></li>
<li>Create </li>
</ul>
<p><img alt="" src="../img/fwb-ws-mlp2.png" /></p>
<p><strong><em>This is what you will see on the FortiWeb as it is preconfigured</em></strong> <br />
<img alt="" src="../img/fwb-ws-mlp1.png" /></p>
<h4 id="a3-enable-machine-learning-advanced-settings-from-cli">A.3. Enable Machine Learning advanced settings from CLI</h4>
<p><strong>(This is for verification only, it has been preconfigured)</strong></p>
<pre><code>config waf machine-learning-policy
 edit 1
   set sample-limit-by-ip 0
   set boxplot-checking-interval 1
end  
</code></pre>
<ul>
<li>
<p><em>sample-limit-by-ip</em> <strong>0</strong> - will accept unlimited requests per source IP.</p>
</li>
<li>
<p><em>boxplot-checking-interval</em> <strong>1</strong> - will test application change every minute.</p>
</li>
</ul>
<h4 id="a4-edit-anomaly-detection-configuration">A.4. Edit Anomaly Detection Configuration</h4>
<p>Configure Machine Learning to be more sensitive to change, this is just for this lab exercise and not part of best practices.</p>
<ul>
<li>
<p>Machine Learning &gt; Machine Learning Policy &gt; Finance</p>
<ul>
<li>Sample Collection Mode: <strong>Normal</strong> (preconfigured)</li>
<li>Update parameter model when number of boxplots do not overlap: <strong>1</strong> (preconfigured)</li>
<li>
<p>Application Change Sensitivity: <strong>High</strong> (preconfigured)
   <!-- * HTTP Method Setting: **Disable** (Need to change this to Disable)--></p>
</li>
<li>
<p>OK</p>
</li>
</ul>
</li>
</ul>
<p><img alt="" src="../img/fwb-ws-ml-setting.png" /></p>
<hr />
<h3 id="b-e-mail-address-input">B. E-mail address input</h3>
<p>Step 1/2: Building a model based on <h7 style="color:red;">e-mail address</h7> input type.</p>
<ul>
<li>
<p>Test Goal: send valid+noise+anomaly+attack mixed traffic.</p>
</li>
<li>
<p>Expected Result: Machine Learning to Detect, Block &amp; Log relevant traffic.</p>
</li>
</ul>
<h4 id="b1-parameter-building">B.1. Parameter Building</h4>
<h5 id="b11-launch-traffic-generator-script-from-lubuntu-client-in-order-to-send-email-format-inputs-to-the-web-application">B.1.1. Launch Traffic Generator Script from Lubuntu Client in order to send ==email== format inputs to the web application</h5>
<p><code>lubuntu@lubuntu:~$ cd ~</code> <br />
<code>lubuntu@lubuntu:~$ ./FortiDemo-ML-AD-traffic.sh</code></p>
<ul>
<li>Enter choice: <strong>9</strong></li>
<li>Amount of requests: <strong>3000</strong></li>
<li>URL: <strong>http://finance.fortinet.demo/fwb/index.html</strong></li>
<li>Method: <strong>POST</strong></li>
<li>Parameter name: <strong>firstname</strong></li>
<li>Parameter type: <strong>email</strong></li>
</ul>
<p><img alt="" src="img/fwb-ws-ml-request1.png" /></p>
<h5 id="b12-manually-submit-some-post-with-non-regular-inputs-before-model-status-is-in-running-stage">B.1.2. Manually Submit some POST with non-regular inputs <strong>before</strong> model status is in Running stage</h5>
<ul>
<li>Browse <strong>http://finance.fortinet.demo/fwb/index.html</strong></li>
</ul>
<p><strong>Note: You can copy and past the samples from <em>AttackSamples.txt</em> file located on the Lubuntu Desktop</strong></p>
<ul>
<li>
<p>Submit following inputs in <em>firstname</em> field:</p>
</li>
<li>
<p>\&lt;script>alert\&lt;/script></p>
</li>
<li>1 or 1=1</li>
<li>xxxxxxx</li>
<li>xxx.xxx@xxx.xxx</li>
<li>Wed May 17 10:59:36 EDT 2006</li>
<li>02 08 2010 09:44:57</li>
<li>abc;$compress_message=gzcompress("hack message", 12)</li>
</ul>
<p><img alt="" src="../img/fwb-ws-ml-submit-noise.png" /></p>
<ul>
<li>Check Attack Log if you get blocked.</li>
<li>Analyze Attack Log.</li>
</ul>
<h5 id="b13-check-firstname-hmm-learning-stage-changes-under-tree-view-until-firstname-is-on-running-stage">B.1.3. Check <em>firstname</em>  HMM Learning Stage changes under Tree View until <em>firstname</em> is on running stage</h5>
<p><strong>Collecting</strong>
<img alt="" src="img/fwb-ws-ml-stage-collect-fn.png" /></p>
<p><strong>Testing</strong>
<img alt="" src="img/fwb-ws-ml-stage-test-fn.png" /></p>
<p><strong>Running</strong>
<img alt="" src="img/fwb-ws-ml-stage-running-fn.png" /></p>
<h5 id="b14-manually-re-submit-same-post-with-non-regular-inputs-when-model-status-is-in-running-stage">B.1.4. Manually re-Submit same POST with non-regular inputs when model status is in Running stage</h5>
<ul>
<li>Browse <strong>http://finance.fortinet.demo/fwb/index.html</strong></li>
</ul>
<p><strong>Note: You can copy and past the samples from <em>AttackSamples.txt</em> file located on the Lubuntu Desktop</strong></p>
<ul>
<li>
<p>Re-Submit same inputs in <em>firstname</em> field:</p>
</li>
<li>
<p>\&lt;script>alert\&lt;/script></p>
</li>
<li>1 or 1=1</li>
<li>/%3F%3F%3F/1%3F - /???/1?</li>
<li>xxx.xxx@xxx.xxx</li>
<li>Wed May 17 10:59:36 EDT 2006</li>
<li>02 08 2010 09:44:57</li>
<li>abc;$compress_message=gzcompress("hack message", 12)</li>
</ul>
<p><img alt="" src="../img/fwb-ws-ml-submit-noise.png" /></p>
<ul>
<li>Check Attack Log if you get blocked.</li>
<li>Analyze Attack Log.</li>
</ul>
<p><img alt="" src="img/fwb-ws-ml-block1.png" /></p>
<p><img alt="" src="img/fwb-ws-ml-attacklog1.png" /></p>
<p><img alt="" src="img/fwb-ws-ml-attack1-fn.png" /></p>
<h4 id="b2-exceptions">B.2. Exceptions</h4>
<p>Create Exceptions in order to white list some non-regular inputs</p>
<ul>
<li>Create Exceptions for some inputs in <em>firstname</em> field<ul>
<li>abc;$compress_message=gzcompress("hack message", 12)</li>
</ul>
</li>
</ul>
<p><img alt="" src="img/fwb-ws-ml-param-exception.png" /></p>
<ul>
<li>Browse <strong>http://finance.fortinet.demo/fwb/index.html</strong></li>
<li>Re-submit <strong><em>abc;$compress_message=gzcompress("hack message", 12)</em></strong> again, they should <strong>NOT</strong> be blocked.</li>
</ul>
<p><strong>Please have <em>ALL</em> the additional samples deleted before moving to the next excercise!</strong></p>
<ul>
<li>Machine Learning &gt; Anomaly Detection &gt; Finance</li>
<li>Double click on <strong>finance.fortinet.demo</strong> (or hamburger menu) &gt; Parameter View</li>
<li><em>firstname</em> &gt; Additional Samples</li>
</ul>
<p><img alt="" src="img/fwb-ws-ml-delete-sample.png" /></p>
<h4 id="b3-adjust-strictness">B.3. Adjust Strictness</h4>
<p>Change Strictness Level for Anomaly in order to accept some more Anomalies inside the model</p>
<h5 id="b31-launch-traffic-generator-script-from-lubuntu-client-in-order-to-send-email-format-inputs-to-the-web-application">B.3.1. Launch Traffic Generator Script from Lubuntu Client in order to send ==email== format inputs to the web application</h5>
<p><code>lubuntu@lubuntu:~$ cd ~</code> <br />
<code>lubuntu@lubuntu:~$ ./FortiDemo-ML-AD-traffic.sh</code></p>
<ul>
<li>Enter choice: <strong>9</strong></li>
<li>Amount of requests: <strong>3000</strong></li>
<li>URL: <strong>http://finance.fortinet.demo/fwb/index.html</strong></li>
<li>Method: <strong>POST</strong></li>
<li>Parameter name: <strong>firstname</strong></li>
<li>Parameter type: <strong>email</strong></li>
</ul>
<p><img alt="" src="img/fwb-ws-ml-request1.png" /></p>
<h5 id="b32-change-stricness-level-for-anomaly">B.3.2. Change Stricness Level for Anomaly</h5>
<ul>
<li>Machine Learning &gt; Anomaly Detection &gt; Finance</li>
<li>Double click on <strong>finance.fortinet.demo</strong> (or hamburger menu) &gt; Parameter View</li>
<li><em>firstname</em> &gt; Change Custom Sigma to <strong>1</strong></li>
<li>See new Anomaly Strictness graph.</li>
<li>See new Anomaly Samples.</li>
</ul>
<p><img alt="" src="img/fwb-ws-ml-adjust-sigma.png" /></p>
<ul>
<li>Test one of the Amomaly Samples.</li>
</ul>
<p><img alt="" src="img/fwb-ws-ml-test-anomalysample.png" /></p>
<h4 id="b4-noisy-samples-test">B.4. Noisy Samples Test</h4>
<p>Select and test some of the Noisy Samples</p>
<p>Noisy Samples are not participating to model building.</p>
<p><strong>Note: This is to be done on the http://finance.fortinet.demo/fwb/index.html page not on the FortiWeb.</strong></p>
<ul>
<li>Select some of the Noisy Samples</li>
<li>Submit them in <em>firstname</em> parameter</li>
<li>Check the Log</li>
</ul>
<p><img alt="" src="img/fwb-ws-ml-test-noisysample.png" /></p>
<p>On the Finance Application, there is no impact on the Noisy Sample being submitted as they don't contain any threat. </p>
<hr />
<h3 id="c-manual-rebuild">C. Manual rebuild</h3>
<p>Step 2/2: Manually re-building the model based on <h7 style="color:red;">number-small</h7> format as NEW input type. Then trigger auto-rebuild based on <h7 style="color:red;">date-long</h7> format as NEW input type.</p>
<ul>
<li>
<p>Test Goal: run traffic with <strong>NEW</strong> type of parameter.</p>
</li>
<li>
<p>Expected Result: </p>
</li>
<li>Manually forcing Machine Learning to rebuild its model according to the <strong>NEW</strong> type of parameter inputs(==number-small==).</li>
<li>Machine Learning to <strong>auto-rebuild</strong> its model according to the <strong>NEW</strong> type of parameter inputs(==date-long==).</li>
</ul>
<h4 id="c1-manual-parameter-rebuilding">C.1. Manual Parameter Rebuilding</h4>
<h5 id="c11-manually-forcing-paramerter-rebuild">C.1.1. Manually forcing Paramerter Rebuild</h5>
<ul>
<li>Machine Learning &gt; Anomaly Detection &gt; Finance</li>
<li>Double click on <strong>finance.fortinet.demo</strong> (or hamburger menu) &gt; Parameter View</li>
<li><em>firstname</em> &gt; Operation &gt; <strong>Rebuild Parameter</strong></li>
<li>OK</li>
</ul>
<p><img alt="" src="img/fwb-ws-ml-manual-rebuild.png" /></p>
<p>Notice the manual <strong>Rebuild Parameter</strong> will remove <em>firstname</em> parameter and you can see it on the tree view, <em>firstname</em> parameter is no longer listed.</p>
<p><img alt="" src="img/fwb-ws-ml-manual-rebuild2.png" /></p>
<h5 id="c12-launch-traffic-generator-script-from-lubuntu-client-in-order-to-send-number-small-format-inputs-to-the-web-application">C.1.2. Launch Traffic Generator Script from Lubuntu Client in order to send ==number-small== format inputs to the web application</h5>
<p><code>lubuntu@lubuntu:~$ cd ~</code> <br />
<code>lubuntu@lubuntu:~$ ./FortiDemo-ML-AD-traffic.sh</code></p>
<ul>
<li>Enter choice: <strong>9</strong></li>
<li>Amount of requests: <strong>3000</strong></li>
<li>URL: <strong>http://finance.fortinet.demo/fwb/index.html</strong></li>
<li>Method: <strong>POST</strong></li>
<li>Parameter name: <strong>firstname</strong></li>
<li>Parameter type: <strong>number-small</strong></li>
</ul>
<p><img alt="" src="img/fwb-ws-ml-request2.png" /></p>
<h5 id="c13-check-firstname-hmm-learning-stage-changes-under-tree-view-until-firstname-is-on-running-stage">C.1.3. Check <em>firstname</em> HMM Learning Stage changes under Tree View until <em>firstname</em> is on running stage</h5>
<p><strong>Running</strong></p>
<p><img alt="" src="img/fwb-ws-ml-firstname-running.png" /></p>
<h5 id="c14-check-parameter-view-details-for-just-rebuilt-firstname-model">C.1.4. Check Parameter View details for just rebuilt <em>firstname</em> model</h5>
<p><img alt="" src="img/fwb-ws-ml-firstname-rebuild.png" /></p>
<h5 id="c15-manually-test-some-number-small-email-and-dates-samples-into-firstname-field">C.1.5 Manually test some ==number-small==, ==email== and ==dates== samples into <em>firstname</em> field</h5>
<p><strong>Note: You can copy and past the samples from <em>AttackSamples.txt</em> file located on the Lubuntu Desktop</strong></p>
<ul>
<li>Submit <strong>12345678</strong></li>
<li>Submit <strong>YgX5M5fzgw@TNd3jawkWUC.jTPm</strong></li>
<li>Submit <strong>02 08 2010 09:44:57</strong></li>
<li>Submit <strong>Wed May 17 10:59:36 EDT 2006</strong></li>
</ul>
<p><img alt="" src="img/fwb-ws-ml-firstname-manualtest.png" /></p>
<p>Notice that all 4 samples are submmited successfully. From user point of view there is no difference.</p>
<p>Now do the same test but this time on the FortiWeb</p>
<ul>
<li>Machine Learning &gt; Machine Learning Policy &gt; Finance &gt; Parameter View</li>
<li><em>firstname</em> &gt; Test Sample</li>
</ul>
<p><strong>12345678</strong></p>
<p><img alt="" src="img/fwb-ws-ml-numbersmall-normal.png" /></p>
<p><strong>YgX5M5fzgw@TNd3jawkWUC.jTPm</strong></p>
<p><img alt="" src="img/fwb-ws-ml-email-anomaly.png" /></p>
<p><strong>02 08 2010 09:44:57</strong></p>
<p><img alt="" src="img/fwb-ws-ml-dateshort-anomaly.png" /></p>
<p><strong>Wed May 17 10:59:36 EDT 2006</strong></p>
<p><img alt="" src="img/fwb-ws-ml-datelong-anomaly.png" /></p>
<ul>
<li>Only <strong>number</strong> input will be rated as <strong>Normal</strong>, other input formats will be rated as <strong>Anomaly</strong></li>
</ul>
<h4 id="c2-auto-rebuild-trigger">C.2 Auto-rebuild trigger</h4>
<p>Triggering auto-rebuild with <h7 style="color:red;">date-long</h7> new Input</p>
<h5 id="c21-launch-traffic-generator-script-from-lubuntu-client-in-order-to-send-date-long-format-inputs-to-the-web-application">C.2.1. Launch Traffic Generator Script from Lubuntu Client in order to send ==date-long== format inputs to the web application</h5>
<p><code>lubuntu@lubuntu:~$ cd ~</code> <br />
<code>lubuntu@lubuntu:~$ ./FortiDemo-ML-AD-traffic.sh</code></p>
<ul>
<li>Enter choice: <strong>9</strong></li>
<li>Amount of requests: <strong>5000</strong></li>
<li>URL: <strong>http://finance.fortinet.demo/fwb/index.html</strong></li>
<li>Method: <strong>POST</strong></li>
<li>Parameter name: <strong>firstname</strong></li>
<li>Parameter type: <strong>date-long</strong></li>
</ul>
<p><img alt="" src="img/fwb-ws-ml-request3.png" /></p>
<ul>
<li>
<p><em>firstname</em> parameter will be changin it's state from Running -&gt; Collecting -&gt; Building -&gt; Testing -&gt; Running</p>
</li>
<li>
<p>This is done automatically and you can verify this on the Event tab when firstname parameter is at <strong>Running</strong> state</p>
</li>
</ul>
<p><img alt="" src="img/fwb-ws-ml-boxplot-rebuild.png" /></p>
<h5 id="c22-manually-test-some-number-small-email-and-dates-samples-into-firstname-field">C.2.2 Manually test some ==number-small==, ==email== and dates samples into <em>firstname</em> field</h5>
<p><strong>Note: You can copy and past the samples from <em>AttackSamples.txt</em> file located on the Lubuntu Desktop</strong></p>
<ul>
<li>Submit <strong>12345678</strong></li>
<li>Submit <strong>YgX5M5fzgw@TNd3jawkWUC.jTPm</strong></li>
<li>Submit <strong>02 08 2010 09:44:57</strong></li>
<li>Submit <strong>Wed May 17 10:59:36 EDT 2006</strong></li>
</ul>
<p><img alt="" src="img/fwb-ws-ml-firstname-manualtest.png" /></p>
<p>Notice that all 4 samples are submmited successfully. From user point of view there is no difference.</p>
<p>Now do the same test but this time on the FortiWeb</p>
<ul>
<li>Machine Learning &gt; Machine Learning Policy &gt; Finance &gt; Parameter View</li>
<li><em>firstname</em> &gt; Test Sample</li>
</ul>
<p><strong>12345678</strong></p>
<p><img alt="" src="img/fwb-ws-ml-numbersmall-anomaly.png" /></p>
<p><strong>YgX5M5fzgw@TNd3jawkWUC.jTPm</strong></p>
<p><img alt="" src="img/fwb-ws-ml-email-anomaly.png" /></p>
<p><strong>02 08 2010 09:44:57</strong></p>
<p><img alt="" src="img/fwb-ws-ml-dateshort-normal.png" /></p>
<p><strong>Wed May 17 10:59:36 EDT 2006</strong></p>
<p><img alt="" src="img/fwb-ws-ml-datelong-normal.png" /></p>
<ul>
<li>Only <strong>Longdate</strong> is rated as <strong>Normal</strong>, <strong>Shortdate</strong>, <strong>numbers</strong> and <strong>email</strong> are rated as <strong>Anomaly</strong></li>
</ul>
<hr />
<!--###D. Step 3/3: Relearning the model based on ==number-small== format at the same time keeping exisiting model (==date-long==)



* Test: run traffic with **ADDITIONAL** type of parameter.

* Expected Result: Machine Learning to **relearn** its model by keeping previous samples and merging them with additional **ADDITIONAL** type of parameter inputs.



####D.1. Parameter Re-Learning 

#####D.1.1. Manually launch the Relearn Parameter on *firstname*

* Machine Learning > Anomaly Detection > Finance
* Double click on **finance.fortinet.demo** (or hamburger menu) > Parameter View 
* *firstname* > Operation > **Relearn Parameter**
* OK

![](img/fwb-ws-ml-trigger-relearn-fn.png)

*firname* parameter will change from Running Mode to Collection Mode after we manaully triggfer the relearn

![](img/fwb-ws-ml-trigger-relearn-fn2.png)

#####D.1.2. Launch Traffic Generator Script from Lubuntu Client in order to send ==number-small== format inputs to the web application



`lubuntu@lubuntu:~$ cd ~`
`lubuntu@lubuntu:~$ ./FortiDemo-ML-AD-traffic.sh`

   * Enter choice: **9**
   * Amount of requests: **3000**
   * URL: **http://finance.fortinet.demo/fwb/index.html**
   * Method: **POST**
   * Parameter name: **firstname**
   * Parameter type: **number-small**

![](img/fwb-ws-ml-request4.png)


#####D.1.3. Check *firstname* HMM Learning Stage changes under Tree View until *firstname* is on running stage

![](img/fwb-ws-ml-firstname-running.png)

#####D.1.4. Check Parameter View details for just relearned *firstname* model

![](img/fwb-ws-ml-firstname-relearn2.png)


####D.2. Manually test some ==number-small==, ==email== and ==dates== samples into *firstname* field


**Note: You can copy and past the samples from *AttackSamples.txt* file located on the Lubuntu Desktop**

* Submit **12345678**
* Submit **YgX5M5fzgw@TNd3jawkWUC.jTPm**
* Submit **02 08 2010 09:44:57**
* Submit **Wed May 17 10:59:36 EDT 2006**

![](img/fwb-ws-ml-firstname-manualtest.png)

Notice that all 4 samples are submmited successfully. From user point of view there is no difference.

Now we will do the same test but this time we wll do it on the FortiWeb

* Machine Learning > Machine Learning Policy > Finance > Parameter View
* *firstname* > Test Sample

`12345678`

![](img/fwb-ws-ml-numbersmall-normal2.png)

`YgX5M5fzgw@TNd3jawkWUC.jTPm`

![](img/fwb-ws-ml-eamil-anomaly2.png)

`02 08 2010 09:44:57`

![](img/fwb-ws-ml-dateshort-normal2.png)

`Wed May 17 10:59:36 EDT 2006`

![](img/fwb-ws-ml-datelong-normal2.png)


* **Shortdate**, **Longdate** and **numbers** are rated as **NORMAL**
* **Relearn Parameter will allow Machine Learning to keep existing model and at the same time  take in new samples and rebuild new HMM model based on the merger of the existing samples and new samples.** 

-->

<p>SUMMARY</p>
<pre><code class="language-script">Legacy WAF:
Negative Security: Signatures :-(
Negative+Positive Security:
Application Learning :-(


FortiWeb NG-WAF Machine Learning AI

Layer1: Anomaly Detection (HMM)
Layer2: Attack Identification (SVM)

:-) Detect ZERO DAYs
:-) No False Positive / No False Negative
:-) No possible EVASION
:-) No Tuning (FP/FN/Application Change)

</code></pre>
<p>This workshop is now complete.</p>
              
            </div>
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
      <p>© Fortinet</p>
    
  </div>

  Provided by CSE-team International.
</footer>
      
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="versions">
    <span class="rst-current-version" data-toggle="rst-current-version">
      
      
      
    </span>
</div>
    <script>var base_url = '..';</script>
    <script src="../js/theme.js" defer></script>
      <script src="../search/main.js" defer></script>
    <script defer>
        window.onload = function () {
            SphinxRtdTheme.Navigation.enable(true);
        };
    </script>

</body>
</html>
