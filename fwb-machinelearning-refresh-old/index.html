<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <meta name="author" content="fkemps@fortinet.com">
  
  <link rel="shortcut icon" href="../img/favicon.ico">
  <title>Fwb machinelearning refresh old - FortiWeb Machine Learning</title>
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700" />

  <link rel="stylesheet" href="../css/theme.css" />
  <link rel="stylesheet" href="../css/theme_extra.css" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/github.min.css" />
  
  <script>
    // Current page data
    var mkdocs_page_name = "Fwb machinelearning refresh old";
    var mkdocs_page_input_path = "fwb-machinelearning-refresh-old.md";
    var mkdocs_page_url = null;
  </script>
  
  <script src="../js/jquery-2.1.1.min.js" defer></script>
  <script src="../js/modernizr-2.8.3.min.js" defer></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
  <script>hljs.initHighlightingOnLoad();</script> 
  
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
        <a href=".." class="icon icon-home"> FortiWeb Machine Learning</a>
        <div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="..">Introduction</a>
                    </li>
                </ul>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../fwb-machinelearning-refresh/">Info - Machine Learning</a>
                    </li>
                </ul>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../setup/">Preparation (mandatory)</a>
                    </li>
                </ul>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../fwb-machinelearning-basic/">Demo - Anomaly Detection</a>
                    </li>
                </ul>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../fwb-machinelearning-bot-basic/">Demo - Bot Detection</a>
                    </li>
                </ul>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../fwb-machinelearning-advanced/">Lab - Anomaly Detection</a>
                    </li>
                </ul>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../fwb-machinelearning-api/">Lab - API Protection</a>
                    </li>
                </ul>
      </div>
      <div class="navcenterfabric">
        <img src="../img/fabric-small.png">
      </div>
      <div class="navcenter">
        <img src="../img/fortinetlogonav.png">
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="..">FortiWeb Machine Learning</a>
      </nav>

      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="..">Docs</a> &raquo;</li>
    
      
    
    <li>Fwb machinelearning refresh old</li>
    <li class="wy-breadcrumbs-aside">
      
    </li>
  </ul>
  
  <hr/>
</div>
          <div role="main">
            <div class="section">
              
                <h2 id="fortiweb-machine-learning">FortiWeb Machine Learning</h2>
<h3 id="anomaly-detection">Anomaly Detection</h3>
<h4 id="introduction">Introduction</h4>
<p>With the release of FortiWeb 6.0 machine-learning was added for <strong>Anomaly</strong> and <strong>Bot</strong> detection. This provides Machine Learning based protection against parameter tampering and bot traffic. <br />
This feature can detect and protect web services against unknown/zero-day attacks in addition to the traditional signature based detection methods.</p>
<p>Machine Learning replaced legacy Auto Learn method with NextGen Auto Learn. <br />
Now in addition to learning the web application, it automatically protects it without adminitrative intervention. It even auto adapt to web application's changes.</p>
<p>The anomaly detection model of machine learning feature observes the URLs, parameters of HTTP and HTTPS traffic to the web services. A mathematical models is build to detect abnormal traffic. Whether a request is legitimate or a potential malicious attack, it performs the following tasks:</p>
<ul>
<li>Collects web requests details such as URLs and parameters to build a mathematical model</li>
<li>Matches anomalies against pre-trained threat models</li>
<li>Detects attacks</li>
</ul>
<p>FortiWeb employs two layers of machine learning to detect malicious attacks. The first layer uses the <strong>HMM</strong> (Hidden Markov Model) technique to detect anomalies, the second layer uses the <strong>SVM</strong> (Support Vector Machine) technique to determin if traffic is malicious.</p>
<p>When the first layer (HMM) triggers a request as an anomaly, then FortiWeb will use the second layer (SVM) to verify whether it's a real attack or just a benign anomaly that should be ignored. To do so, FortiWeb includes pre-built trained threat models from FortiGuard. Each represents a certain attack category, such as <strong>SQL Injection</strong>, <strong>Cross-site Scripting</strong>, and so on. </p>
<p>Each threat model is already trained based on analysis of thousands of attack samples from FortiGuard. Threat models are continuously updated using the FortiWeb Security Service. When new attack types are released, the FortiGuard team analyzes the new threats and re-trains the relevant threat model. The new threat model is then pushed to all customer installations in a way similar to how signatures are updated.</p>
<hr />
<h4 id="basic-concepts">Basic Concepts</h4>
<p>FortiWeb, Fortinet’s Web Application Firewall, protects your business-critical web applications from attacks that target known and unknown vulnerabilities.</p>
<p>The attack surface of your web applications evolves rapidly, changing every time you deploy new features, update existing ones, or expose new web APIs. You need a solution that can keep up.  FortiWeb is that solution.</p>
<p>FortiWeb Machine Learning customizes the protection of each application, providing robust protection without requiring the time-consuming manual tuning required by other solutions. With Machine Learning, FortiWeb identifies anomalous behavior and, more importantly, distinguishes between malicious and benign anomalies. The solution also features robust bot mitigation capabilities, allowing benign bots to connect (e.g. search engines) while blocking malicious bot activity.</p>
<p><img alt="" src="../img/fwb-ws-ml-concept.png" /></p>
<hr />
<h4 id="benefits">Benefits</h4>
<p>In addition to regular signature updates and many other layers of defenses, FortiWeb uses Machine Learning to protect against zero-day attacks and minimize false positives. </p>
<hr />
<h4 id="anomaly-detection_1">Anomaly Detection</h4>
<p>The anomaly detection model of machine learning feature observes the URLs, parameters, and HTTP Method of HTTP and/or HTTPS requests passing to your web servers. It builds mathematical models to detect abnormal traffic. </p>
<h5 id="why-ml-anomaly-detection">Why ML - Anomaly Detection?</h5>
<p><img alt="" src="../img/fwb-ws-ml-why.png" /></p>
<p>Address Unknown Web Application Attacks.</p>
<p><img alt="" src="../img/fwb-ws-features-pyramid.png" /></p>
<hr />
<h5 id="high-level-view">High Level View</h5>
<p>To learn about whether a request is legitimate or a potential malicious attack attempt, it performs the following tasks:</p>
<ul>
<li>Captures and collects inputs, such as URL parameters, to build a mathematical model of allowed access</li>
<li>Observes the HTTP method of the traffic</li>
<li>Matches anomalies against pre-trained threat models</li>
<li>Detect and prevent attacks</li>
</ul>
<p><img alt="" src="../img/fwb-ws-ml-2layers.png" /></p>
<p>FortiWeb employs two layers of machine learning to detect malicious attacks. The first layer uses the <strong><em>Hidden Markov Model (HMM)</em></strong> and monitors access to the application and collects data to build a mathematical model behind every parameter and HTTP method. Once completed, it will verify every request against the model to determine whether it's an anomaly or not. </p>
<p><img alt="" src="../img/fwb-ws-ml-hmmlayer.png" /></p>
<p>Once the first layer of machine learning triggers a request as an anomaly, FortiWeb will use the second layer of machine learning <strong>Support Vector Machine (SVM)</strong> to verify whether it's a real attack or just a benign anomaly that should be ignored. To do so, FortiWeb includes pre-built trained threat models. Each represents a certain attack category, such as SQL Injection, Cross-site Scripting, and so on. Each threat model is already trained based on analysis of thousands of attack samples. </p>
<p><img alt="" src="../img/fwb-ws-ml-svmlayer.png" /></p>
<p>Threat models are continuously updated using the <strong>FortiWeb Security Service</strong>. When new attack types are released, the FortiGuard team analyzes the new threats and re-trains the relevant threat model. The new threat model is then pushed to all customer installations in a way similar to how signatures are updated. </p>
<hr />
<h5 id="build-anomaly-detection-model">Build Anomaly Detection Model</h5>
<p>Details: How FortiWeb Machine Learning Builds Anomaly Detection Model</p>
<h6 id="phase-1-collecting-samples">Phase 1 Collecting Samples</h6>
<p><img alt="" src="../img/fwb-ws-ml-phase1.png" /></p>
<ul>
<li>Machine Learning requires at least 400 unique inputs samples (Fast Mode, learning continues to replace with stronger models)</li>
<li>Building Anomaly Detection (AD) model + variance</li>
<li>Switch it in <strong>Running</strong> mode to enable protection</li>
</ul>
<h6 id="phase-2-scoring-results">Phase 2 Scoring Results</h6>
<p><img alt="" src="../img/fwb-ws-ml-phase2.png" /></p>
<h6 id="phase-3-tuning-deviation">Phase 3 Tuning Deviation</h6>
<p>Tuning of the Standard Deviation (sigma) if needed for Anomaly Strictness</p>
<p><img alt="" src="../img/fwb-ws-ml-phase3.png" /></p>
<p><strong>Actual Graph Sample</strong></p>
<p><img alt="" src="../img/fwb-ws-ml-mla.png" /></p>
<h5 id="verify-anomaly-detection-model">Verify Anomaly Detection Model</h5>
<p>Details: Verifying Anomaly with SVM Threat Model</p>
<p>How to read the graph</p>
<p><img alt="" src="../img/fwb-ws-ml-mla2.png" /></p>
<p>Once Anomaly been detected, FortiWeb will hand it over to <strong>Support Vactor Machine(SVM)</strong> layer</p>
<ul>
<li>SVM Threat Model<br />
<img alt="" src="../img/fwb-ws-ml-mlc.png" /></li>
</ul>
<p> </p>

<ul>
<li>Pattern Vectorization  : converting the pattern into a vector by using a word dictionary<ul>
<li>Pattern example : <code>&lt;img src = ‘x’ onerror = javascript:alert(1)&gt;</code><ul>
<li><em>img</em> &gt; HTML Label = index2 + weight2</li>
<li><em>&lt; &gt;</em> = ‘ ( ) &gt; special characters = index1 + weight0.5</li>
<li><em>src</em> &gt; HTML Attribute = index3 + weight1</li>
<li><em>onerror</em> &gt; HTML Event= index4 + weight2</li>
<li><em>alert</em> &gt; &gt; HTML Function= index5 + weight1</li>
<li>Final Vector : 1:0,5 2:2 3:1 4:2 5:1</li>
</ul>
</li>
</ul>
</li>
</ul>
<p> </P>

<ul>
<li>Pattern Vector Mitigation by SVM Threat Model<ul>
<li>SVM Threat Models are continuously updated and pushed from <strong><em>FortiGuard</em></strong><ul>
<li>One SVM per family : SQLi, XSS, Command Injection, Code Injection, LFI/ RFI, Common Injection and Remote Exploits   </li>
<li>SVM detects FPs and FNs</li>
<li>SVM vectors are provided by <strong><em>ForitGuard</em></strong> for <strong><em>on-box detection</em></strong> and as such there is <strong>no performance impact on FortiWeb</strong>  </li>
<li>SVM can allow the pattern (if no match svm model) or block it (if matches svm model)</li>
<li>Ex : abc_123 &gt; not detected as anomaly; no need to check it on  SVM<ul>
<li>Ex : abc_123 &gt; detected as anomaly but not matching SVM attack</li>
<li>Ex : or '1'='1' &gt; detected as anomaly and matching SVM SQLi</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<p> </p>
<ul>
<li>Attack Detection model with SVM engines</li>
</ul>
<p><img alt="" src="../img/fwb-ws-ml-mlb.png" /></p>
<hr />
<h5 id="detect-and-adapt-to-changes">Detect and adapt to changes</h5>
<p>Details: Detecting and Adapting to Application changes Automatically</p>
<ul>
<li>If a parameter change is detected the status will automatically go into Samples Collection and build an updated model (merge)</li>
</ul>
<p><strong>NOTE: Maching Learning - Anomaly Detection is per paramater. The process is done for each parameter individually.</strong></p>
<hr />
<h5 id="machine-learning-benefits">Machine Learning Benefits</h5>
<p>Summary: FortiWeb Machine Learning for protecting Application Benefits</p>
<ul>
<li>Completely automatic</li>
<li>Near False Positives Free</li>
<li>Near False Negatives Free</li>
<li>Follows parameter changes</li>
</ul>
<p><strong>Knowledge refresh is now complete, you can go back to the Workshop challenge</strong></p>
<p>Online Admin Guide on ML-Anomaly Detection is available <a href="https://docs.fortinet.com/document/fortiweb/7.0.0/administration-guide/94907/configuring-anomaly-detection-policy">here</a></p>
<hr />
<h3 id="bot-detection">Bot Detection</h3>
<h4 id="introduction_1">Introduction</h4>
<p><img style="float: right;" src="/img/bot-mitigation-icon.png">
FortiWeb applies AI-based bot detection to block malicious bot activity without blocking bots that support legitimate business needs, such as search engines, or health and performance monitoring tools.</p>
<p>FortiWeb offers AI-based <strong>Machine Learning - Bot Detection</strong> that complements the Bot Mitigation and DoS based protection functions. With this Machine Learning-based capability, you can deploy FortiWeb to detect sophisticated bots that can otherwise go undetected.</p>
<p>FortiWeb Machine Learning for Bot Detection can detect bot-like traffic
from the scraper, web vulnerability scanner, crawler, Dos tools, and so
on.
It observes user behavior from <strong>thirteen dimensions</strong> to validate if requests are initiated by a human (browsing) or not. Validation is for example done on
how many HTTP-requests are initiated by the user, whether the
request use illegal HTTP versions, type of browser agent, valid referrers, whether it fetches JSON/XML resources to name a few.</p>
<p><img alt="" src="../img/fwb-ws-ml-bot.png" /></p>
<p>The benefit to the traditional mechanisms to detect bots, the bot
detection model saves you the trouble to experiment on an appropriate
threshold to detect abnormal user behaviors. 
For example, how would you estimate how many initiated HTTP-requests should be considered as abnormal? With the traditional mechanism, you may need to experiment on different threshold values and continuously check the attack log until no related attacks (False Positives) are reported for regular traffic.</p>
<p>FortiWeb Machne Learning uses SVM (Support Vector Machine) algorithm to build up the bot detection model which is self-learned from traffic patterns of regular clients. New client HTTP-requests are compared against that of the regular clients based on the mathimatical model created. If requests of a particular client don't match over the configured periode (anomaly), than FortiWeb will classify that client as a bot. </p>
<p>When the traffic patterns of the regular clients vary dramatically (e.g. the functions of your application have changed leading to different behavior), FortiWeb automatically refreshes the bot detection model to adapt to the changes.</p>
<h4 id="basic-concepts_1">Basic Concepts</h4>
<p>The bot detection model has three stages: <strong><em>sample collecting</em></strong>, <strong><em>model building</em></strong>, and <strong><em>model running</em></strong>.</p>
<p><strong>Sample Collecting</strong><br />
To build up a bot detection model, the system collects samples (also called vector) of users' behaviors when they are visiting your application. Each sample records a certain user's behaviors in a certain time range.</p>
<p>The samples are split into two parts. Three quarters of the samples are divided into training sample set. One quarter of the samples are divided into testing sample set.</p>
<p><strong>Model Building</strong> <br />
During the model building stage, the system observes the training samples to self-learn user behavior profiles and builds up mathematical models using the SVM (Support Vector Machine) algorithm. The SVM parameters are used to eliminate rogue training samples and control individual sample influence on the overall result.</p>
<p>Multiple models are built based on different parameter combinations in the SVM algorithm. According to the training accuracy, cross-validation value, testing accuracy, and the model type you have configured, the system narrows down the selection to one model and uses it as the bot detection model.</p>
<p><strong>Model Running</strong> <br />
When the bot detection model is in running state, the system compares users' behaviors against the bot detection model. If the traffic from a certain user doesn't match the model, the system will record the traffic as an anomaly. If a certain times of anomalies are recorded for this user, the system will take actions such as sending alert emails or blocking the traffic from this user.</p>
<p>It's possible that sometimes the traffic is false positively detected as an anomaly. The system uses Bot Confirmation to confirm whether an anomaly is indeed a bot. If the false positive detection occurs so many times that it exceeds a certain threshold, the system considers the current bot detection model invalid, and automatically updates the model.</p>
<p><img alt="" src="../img/fwb-ws-ml-bot-graph.png" /></p>
<h4 id="benefits_1">Benefits</h4>
<ul>
<li>Completely Automatic</li>
<li>Near False Positives Free</li>
<li>Near False Negatives Free</li>
</ul>
<p>Online Admin Guide on ML-Bot Detection is available <a href="https://docs.fortinet.com/document/fortiweb/7.0.0/administration-guide/600188/configuring-bot-detection-policy">here</a></p>
<!---
###API Detection

--->
              
            </div>
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
      <p>© Fortinet</p>
    
  </div>

  Provided by CSE-team International.
</footer>
      
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="versions">
    <span class="rst-current-version" data-toggle="rst-current-version">
      
      
      
    </span>
</div>
    <script>var base_url = '..';</script>
    <script src="../js/theme.js" defer></script>
      <script src="../search/main.js" defer></script>
    <script defer>
        window.onload = function () {
            SphinxRtdTheme.Navigation.enable(true);
        };
    </script>

</body>
</html>
